const fs = require('fs');

// List of unused keys to remove (from the analysis)
const unusedKeys = [
  'about.description',
  'about.getStarted',
  'about.learnMore',
  'about.values.simplicity.desc',
  'about.values.simplicity.title',
  'about.values.title',
  'articleDetail.actions.delete',
  'articleDetail.actions.edit',
  'articleDetail.actions.report',
  'articleDetail.author',
  'articleDetail.comments.addComment',
  'articleDetail.comments.login',
  'articleDetail.comments.noComments',
  'articleDetail.comments.title',
  'articleDetail.lastUpdated',
  'articleDetail.moreFromAuthor',
  'articleDetail.publishedOn',
  'articleDetail.readTime',
  'articleDetail.relatedArticles',
  'articleDetail.share.copyLink',
  'articleDetail.share.facebook',
  'articleDetail.share.linkCopied',
  'articleDetail.share.linkedin',
  'articleDetail.share.title',
  'articleDetail.share.twitter',
  'articles.bookmarkArticle',
  'articles.bookmarks',
  'articles.by',
  'articles.draft',
  'articles.featured',
  'articles.lastUpdated',
  'articles.latest',
  'articles.likes',
  'articles.loadMore',
  'articles.noArticles',
  'articles.publish',
  'articles.published',
  'articles.publishedOn',
  'articles.readTime',
  'articles.relatedArticles',
  'articles.shareArticle',
  'articles.title',
  'articles.trending',
  'articles.unbookmarkArticle',
  'articles.unpublished',
  'articles.views',
  'articles.writeNew',
  'auth.forgotPassword.backToLogin',
  'auth.forgotPassword.email',
  'auth.forgotPassword.sendButton',
  'auth.forgotPassword.subtitle',
  'auth.forgotPassword.title',
  'auth.login.forgotPassword',
  'auth.login.loginButton',
  'auth.login.rememberMe',
  'auth.register.agreeTerms',
  'auth.register.haveAccount',
  'auth.register.lastName',
  'auth.register.lastNameRequired',
  'auth.register.registerButton',
  'blogs.allPosts',
  'blogs.bookmark',
  'blogs.categories.ai',
  'blogs.categories.datasecurity',
  'blogs.categories.deeplearning',
  'blogs.categories.informationretrieval',
  'blogs.categories.languagemodels',
  'blogs.categories.machinelearning',
  'blogs.categories.nlp',
  'blogs.categories.optimization',
  'blogs.categories.performance',
  'blogs.categories.privacy',
  'blogs.comments',
  'blogs.featured',
  'blogs.like',
  'blogs.noArticles',
  'blogs.popular',
  'blogs.published',
  'blogs.readMore',
  'blogs.recent',
  'blogs.relatedPosts',
  'blogs.search.latest',
  'blogs.search.oldest',
  'blogs.search.popular',
  'blogs.share',
  'blogs.shareArticle',
  'blogs.sorting.oldest',
  'blogs.sorting.popular',
  'blogs.unbookmark',
  'blogs.unlike',
  'blogs.updated',
  'blogs.views',
  'bookmarks.articleSaved',
  'bookmarks.bookmarkRemoved',
  'bookmarks.bookmarkedArticlesAppearHere',
  'bookmarks.clickHeartIcon',
  'bookmarks.failedToLoadBookmarks',
  'bookmarks.loginToBookmark',
  'bookmarks.noBookmarksYet',
  'bookmarks.removeBookmark',
  'bookmarks.startBookmarking',
  'common.actions',
  'common.author',
  'common.category',
  'common.date',
  'common.delete',
  'common.description',
  'common.edit',
  'common.filter',
  'common.loading',
  'common.next',
  'common.previous',
  'common.readMore',
  'common.save',
  'common.search',
  'common.showLess',
  'common.showMore',
  'common.sort',
  'common.status',
  'common.submit',
  'common.tags',
  'common.title',
  'common.view',
  'contact.form.emailAddress',
  'contact.form.error',
  'contact.form.name',
  'contact.form.send',
  'contact.form.success',
  'contact.info.address',
  'contact.info.emailAlt',
  'contact.info.phoneAlt',
  'contact.social.facebook',
  'contact.social.instagram',
  'contact.social.linkedin',
  'contact.social.title',
  'contact.social.twitter',
  'contact.subtitle',
  'contact.title',
  'dashboard.activeUsers',
  'dashboard.admin',
  'dashboard.admins',
  'dashboard.all',
  'dashboard.confirmDelete',
  'dashboard.createdAt',
  'dashboard.deleteUser',
  'dashboard.editUser',
  'dashboard.email',
  'dashboard.failedToDeleteUser',
  'dashboard.failedToFetchUsers',
  'dashboard.failedToUpdateUser',
  'dashboard.filterByRole',
  'dashboard.filterByStatus',
  'dashboard.loadingUsers',
  'dashboard.moderator',
  'dashboard.name',
  'dashboard.refresh',
  'dashboard.search',
  'dashboard.sortBy',
  'dashboard.thisMonth',
  'dashboard.title',
  'dashboard.totalUsers',
  'dashboard.userDeletedSuccessfully',
  'dashboard.userManagement',
  'dashboard.userUpdatedSuccessfully',
  'errors.failedToLoadFollowersList',
  'errors.failedToLoadFollowingList',
  'errors.forbidden',
  'errors.general',
  'errors.invalidDate',
  'errors.loadingError',
  'errors.network',
  'errors.networkError',
  'errors.networkErrorMessage',
  'errors.noDate',
  'errors.noEmailProvided',
  'errors.notFound',
  'errors.notFoundMessage',
  'errors.pleaseLoginToInteract',
  'errors.pleaseLoginToSubmitTest',
  'errors.saveError',
  'errors.serverError',
  'errors.serverErrorMessage',
  'errors.unauthorized',
  'errors.unauthorizedMessage',
  'errors.unknownError',
  'errors.validation.email',
  'errors.validation.password',
  'errors.validation.passwordMatch',
  'errors.validation.required',
  'footer.categories',
  'footer.followUs',
  'footer.newsletter',
  'footer.newsletterText',
  'footer.privacyPolicy',
  'footer.subscribe',
  'footer.termsOfService',
  'home.cta.getStarted',
  'home.cta.learnMore',
  'home.cta.subtitle',
  'home.cta.title',
  'home.featuredAuthors.title',
  'home.featuredAuthors.viewProfile',
  'home.stats.articles',
  'home.stats.authors',
  'home.stats.bookmarks',
  'home.stats.countries',
  'home.stats.readers',
  'home.stats.totalViews',
  'messages.articleSaved',
  'messages.cacheStatus',
  'messages.failedToCopyLink',
  'messages.failedToCreateQATest',
  'messages.failedToDislikeArticle',
  'messages.failedToGenerateQuestions',
  'messages.failedToLikeArticle',
  'messages.failedToLoadArticles',
  'messages.failedToLoadStatistics',
  'messages.failedToLoadTestQuestions',
  'messages.failedToSubmitTest',
  'messages.failedToUpdateQATest',
  'messages.linkCopiedToClipboard',
  'messages.loaded',
  'messages.loading',
  'messages.loadingQuestions',
  'messages.noQuestionsFound',
  'messages.noQuestionsLoaded',
  'messages.pleaseWaitUpTo30Seconds',
  'messages.profileUpdatedSuccessfully',
  'messages.qaTestCreatedSuccessfully',
  'messages.qaTestUpdatedSuccessfully',
  'messages.userDeletedSuccessfully',
  'messages.userUpdatedSuccessfully',
  'myArticles.allArticles',
  'myArticles.analytics',
  'myArticles.articlePublishedSuccessfully',
  'myArticles.commentsLabel',
  'myArticles.confirmPublish',
  'myArticles.createdAt',
  'myArticles.deleteArticle',
  'myArticles.draft',
  'myArticles.draftArticles',
  'myArticles.editArticle',
  'myArticles.lastUpdated',
  'myArticles.likesLabel',
  'myArticles.noArticlesYet',
  'myArticles.noDrafts',
  'myArticles.publishDraft',
  'myArticles.published',
  'myArticles.publishedArticles',
  'myArticles.startWriting',
  'myArticles.status',
  'myArticles.totalLikes',
  'myArticles.totalViews',
  'myArticles.viewsLabel',
  'navigation.search',
  'profile.articlesCount',
  'profile.articlesTitle',
  'profile.bio',
  'profile.bookmarks',
  'profile.discoverArticles',
  'profile.followers',
  'profile.followersModal',
  'profile.following',
  'profile.followingModal',
  'profile.joinedDate',
  'profile.location',
  'profile.myArticles',
  'profile.personalInfo',
  'profile.recentArticles',
  'profile.socialLinks',
  'profile.statistics',
  'profile.title',
  'profile.totalLikes',
  'profile.totalViews',
  'profile.updateError',
  'profile.updateSuccess',
  'profile.website',
  'qa.addQuestion',
  'qa.aiSettings',
  'qa.answers',
  'qa.cancel',
  'qa.category',
  'qa.confirmDelete',
  'qa.correctAnswer',
  'qa.deleteQuestion',
  'qa.difficulties.easy',
  'qa.difficulties.hard',
  'qa.difficulties.medium',
  'qa.difficulty',
  'qa.editQuestion',
  'qa.explanation',
  'qa.filterByCategory',
  'qa.filterByDifficulty',
  'qa.form.answersRequired',
  'qa.form.correctRequired',
  'qa.form.generatedSuccess',
  'qa.form.questionRequired',
  'qa.noQuestions',
  'qa.questionText',
  'qa.save',
  'qa.searchQuestions',
  'qa.showMore',
  'qa.tags',
  'qaTest.historyTags.excellent',
  'qaTest.historyTags.fair',
  'qaTest.historyTags.good',
  'qaTest.historyTags.needsImprovement',
  'qaTest.instructions.timeLimit',
  'qaTest.messages.testCompletedScore',
  'qaTest.page.recentAttempts',
  'qaTest.page.subtitle',
  'qaTest.progress.answered',
  'qaTest.progress.question',
  'qaTest.results.correctAnswers',
  'qaTest.testInfo',
  'search.noResultsFound',
  'search.resultsFor',
  'writeArticle.articleTitle',
  'writeArticle.category',
  'writeArticle.categoryRequired',
  'writeArticle.content',
  'writeArticle.contentPlaceholder',
  'writeArticle.contentRequired',
  'writeArticle.coverImage',
  'writeArticle.editTitle',
  'writeArticle.featuredImage',
  'writeArticle.preview',
  'writeArticle.publish',
  'writeArticle.publishError',
  'writeArticle.publishNow',
  'writeArticle.publishSuccess',
  'writeArticle.saveDraft',
  'writeArticle.saveError',
  'writeArticle.saveSuccess',
  'writeArticle.selectCategory',
  'writeArticle.tags',
  'writeArticle.tagsPlaceholder',
  'writeArticle.title',
  'writeArticle.titlePlaceholder',
  'writeArticle.titleRequired',
  'writeArticle.uploadImage'
];

// Function to remove a key path from an object
function removeKey(obj, keyPath) {
  const keys = keyPath.split('.');
  if (keys.length === 1) {
    delete obj[keys[0]];
    return;
  }
  
  const [firstKey, ...restKeys] = keys;
  if (obj[firstKey] && typeof obj[firstKey] === 'object') {
    removeKey(obj[firstKey], restKeys.join('.'));
    
    // If the object is now empty, remove it
    if (Object.keys(obj[firstKey]).length === 0) {
      delete obj[firstKey];
    }
  }
}

// Function to clean up translation file
function cleanTranslationFile(filename) {
  console.log(`Cleaning ${filename}...`);
  
  const content = fs.readFileSync(filename, 'utf8');
  const match = content.match(/export\s+const\s+\w+\s*=\s*({[\s\S]*});/);
  
  if (!match) {
    console.log(`Could not parse ${filename}`);
    return;
  }
  
  const translationObject = eval('(' + match[1] + ')');
  
  // Remove unused keys
  let removedCount = 0;
  unusedKeys.forEach(key => {
    const keyExists = key.split('.').reduce((obj, k) => obj && obj[k], translationObject);
    if (keyExists !== undefined) {
      removeKey(translationObject, key);
      removedCount++;
    }
  });
  
  console.log(`Removed ${removedCount} unused keys from ${filename}`);
  
  // Convert back to string format
  const variableName = filename === 'en.js' ? 'en' : 'vi';
  const newContent = `export const ${variableName} = ${JSON.stringify(translationObject, null, 2)};
`;
  
  // Write back to file
  fs.writeFileSync(filename, newContent, 'utf8');
  console.log(`Updated ${filename} successfully`);
}

// Clean both files
cleanTranslationFile('en.js');
cleanTranslationFile('vi.js');

console.log('\\nCleanup completed! Both translation files have been optimized.');
console.log('All unused keys have been removed while preserving the actively used ones.');
